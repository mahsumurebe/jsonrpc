"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const ServerError_1 = require("../../../Errors/ServerError");
class Output {
    static _errorToObj(e) {
        let out = {};
        if (e instanceof ServerError_1.ServerError) {
            out = e.toJSON();
            if (out.data && out.data instanceof Error) {
                out.data = Output._errorToObj(out.data);
            }
        }
        else if (e instanceof Error) {
            out = {
                code: e.name,
                message: e.message,
                stack: e.stack,
            };
        }
        return out;
    }
    static generate(data, req, res) {
        if (data instanceof Error) {
            return {
                id: req.id || null,
                jsonrpc: req.jsonrpc || '2.0',
                error: Output._errorToObj(data),
                result: null
            };
        }
        else {
            return {
                id: req.id,
                jsonrpc: req.jsonrpc,
                result: data
            };
        }
    }
}
exports.Output = Output;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi9zcmMvU2VydmVyL0xpYnJhcnkvT3V0cHV0L2luZGV4LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBRUEsNkRBQXlFO0FBRXpFLE1BQWEsTUFBTTtJQUNmLE1BQU0sQ0FBQyxXQUFXLENBQUMsQ0FBYztRQUM3QixJQUFJLEdBQUcsR0FBMEIsRUFBRSxDQUFDO1FBRXBDLElBQUksQ0FBQyxZQUFZLHlCQUFXLEVBQUU7WUFDMUIsR0FBRyxHQUFHLENBQUMsQ0FBQyxNQUFNLEVBQUUsQ0FBQztZQUNqQixJQUFJLEdBQUcsQ0FBQyxJQUFJLElBQUksR0FBRyxDQUFDLElBQUksWUFBWSxLQUFLLEVBQUU7Z0JBQ3ZDLEdBQUcsQ0FBQyxJQUFJLEdBQUcsTUFBTSxDQUFDLFdBQVcsQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLENBQUM7YUFDM0M7U0FDSjthQUFNLElBQUksQ0FBQyxZQUFZLEtBQUssRUFBRTtZQUMzQixHQUFHLEdBQUc7Z0JBQ0YsSUFBSSxFQUFFLENBQUMsQ0FBQyxJQUFJO2dCQUNaLE9BQU8sRUFBRSxDQUFDLENBQUMsT0FBTztnQkFDbEIsS0FBSyxFQUFFLENBQUMsQ0FBQyxLQUFLO2FBQ2pCLENBQUM7U0FDTDtRQUVELE9BQU8sR0FBRyxDQUFDO0lBQ2YsQ0FBQztJQUdELE1BQU0sQ0FBQyxRQUFRLENBQUMsSUFBUyxFQUFFLEdBQXNCLEVBQUUsR0FBYTtRQUU1RCxJQUFJLElBQUksWUFBWSxLQUFLLEVBQUU7WUFDdkIsT0FBTztnQkFDSCxFQUFFLEVBQUUsR0FBRyxDQUFDLEVBQUUsSUFBSSxJQUFJO2dCQUNsQixPQUFPLEVBQUUsR0FBRyxDQUFDLE9BQU8sSUFBSSxLQUFLO2dCQUM3QixLQUFLLEVBQUUsTUFBTSxDQUFDLFdBQVcsQ0FBQyxJQUFJLENBQVE7Z0JBQ3RDLE1BQU0sRUFBRSxJQUFJO2FBQ2YsQ0FBQztTQUNMO2FBQU07WUFDSCxPQUFPO2dCQUNILEVBQUUsRUFBRSxHQUFHLENBQUMsRUFBRTtnQkFDVixPQUFPLEVBQUUsR0FBRyxDQUFDLE9BQU87Z0JBQ3BCLE1BQU0sRUFBRSxJQUFJO2FBQ2YsQ0FBQztTQUNMO0lBQ0wsQ0FBQztDQUNKO0FBdENELHdCQXNDQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7UmVzcG9uc2V9IGZyb20gXCJleHByZXNzXCI7XG5pbXBvcnQge1JQQ30gZnJvbSBcIi4uLy4uLy4uL0B0eXBlcy90eXBlc1wiO1xuaW1wb3J0IHtTZXJ2ZXJFcnJvciwgU2VydmVyRXJyb3JKc29ufSBmcm9tIFwiLi4vLi4vLi4vRXJyb3JzL1NlcnZlckVycm9yXCI7XG5cbmV4cG9ydCBjbGFzcyBPdXRwdXQge1xuICAgIHN0YXRpYyBfZXJyb3JUb09iaihlOiBFcnJvciB8IGFueSkge1xuICAgICAgICBsZXQgb3V0OiBTZXJ2ZXJFcnJvckpzb24gfCBhbnkgPSB7fTtcblxuICAgICAgICBpZiAoZSBpbnN0YW5jZW9mIFNlcnZlckVycm9yKSB7XG4gICAgICAgICAgICBvdXQgPSBlLnRvSlNPTigpO1xuICAgICAgICAgICAgaWYgKG91dC5kYXRhICYmIG91dC5kYXRhIGluc3RhbmNlb2YgRXJyb3IpIHtcbiAgICAgICAgICAgICAgICBvdXQuZGF0YSA9IE91dHB1dC5fZXJyb3JUb09iaihvdXQuZGF0YSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSBpZiAoZSBpbnN0YW5jZW9mIEVycm9yKSB7XG4gICAgICAgICAgICBvdXQgPSB7XG4gICAgICAgICAgICAgICAgY29kZTogZS5uYW1lLFxuICAgICAgICAgICAgICAgIG1lc3NhZ2U6IGUubWVzc2FnZSxcbiAgICAgICAgICAgICAgICBzdGFjazogZS5zdGFjayxcbiAgICAgICAgICAgIH07XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gb3V0O1xuICAgIH1cblxuICAgIHN0YXRpYyBnZW5lcmF0ZShkYXRhOiBFcnJvciwgcmVxOiBSUEMuUmVxdWVzdC5JRGF0YSwgcmVzOiBSZXNwb25zZSlcbiAgICBzdGF0aWMgZ2VuZXJhdGUoZGF0YTogYW55LCByZXE6IFJQQy5SZXF1ZXN0LklEYXRhLCByZXM6IFJlc3BvbnNlKTogUlBDLlJlc3BvbnNlLklEYXRhIHtcblxuICAgICAgICBpZiAoZGF0YSBpbnN0YW5jZW9mIEVycm9yKSB7XG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIGlkOiByZXEuaWQgfHwgbnVsbCxcbiAgICAgICAgICAgICAgICBqc29ucnBjOiByZXEuanNvbnJwYyB8fCAnMi4wJyxcbiAgICAgICAgICAgICAgICBlcnJvcjogT3V0cHV0Ll9lcnJvclRvT2JqKGRhdGEpIGFzIGFueSxcbiAgICAgICAgICAgICAgICByZXN1bHQ6IG51bGxcbiAgICAgICAgICAgIH07XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIGlkOiByZXEuaWQsXG4gICAgICAgICAgICAgICAganNvbnJwYzogcmVxLmpzb25ycGMsXG4gICAgICAgICAgICAgICAgcmVzdWx0OiBkYXRhXG4gICAgICAgICAgICB9O1xuICAgICAgICB9XG4gICAgfVxufVxuIl19