"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
const axios_1 = __importDefault(require("axios"));
const qs_1 = require("qs");
const Response_1 = require("./Abstracts/Response");
const ErrorResponse_1 = require("./Abstracts/ErrorResponse");
exports.ErrorResponse = ErrorResponse_1.ErrorResponse;
const __1 = require("..");
class Client {
    constructor(config) {
        config = {
            headers: {
                'Content-Type': 'application/json'
            },
            ...config,
            ...{ paramsSerializer: qs_1.stringify }
        };
        if (config.baseURL) {
            let parsedUrl = new URL(config.baseURL);
            if (parsedUrl.username) {
                let credentials = {
                    username: parsedUrl.username,
                    password: parsedUrl.password,
                };
                delete parsedUrl.username;
                delete parsedUrl.password;
                config['auth'] = credentials;
                config['baseURL'] = parsedUrl.href;
            }
        }
        this.axios = axios_1.default.create(config);
    }
    mapResponse(response, multiple) {
        if (response instanceof Array) {
            return response.map((item) => {
                return this.mapResponse(item, true);
            });
        }
        else {
            if (response.error) {
                if (multiple) {
                    throw new ErrorResponse_1.ErrorResponse(response.error);
                }
                else {
                    // @ts-ignore
                    let data = response.data || null;
                    let errC;
                    switch (response.error.code || -32603) {
                        case -32603:
                            errC = __1.InternalError;
                            break;
                        case -32602:
                            errC = __1.InvalidParams;
                            break;
                        case -32600:
                            errC = __1.InvalidRequest;
                            break;
                        case -32601:
                            errC = __1.MethodNotFound;
                            break;
                        case -32700:
                            errC = __1.ParseError;
                            break;
                        case -32000:
                            errC = __1.ServerError;
                            break;
                    }
                    throw new errC(data, response.error.message || 'Internal error', response.error.code || -32603);
                }
            }
            else {
                if (multiple) {
                    let result = new Response_1.Response();
                    result.code = response.code;
                    result.id = response.id;
                    result.jsonrpc = response.jsonrpc;
                    result.result = response.result;
                    return result;
                }
                else {
                    return response.result;
                }
            }
        }
    }
    async request(url, params) {
        return this.axios
            .post(url, params || this.defaultParams, {})
            .then(response => (response ? response.data : response))
            .catch((err) => {
            if (err.response && err.response.data) {
                return this.mapResponse(err.response.data);
            }
            throw err;
        });
    }
    rpc(...args) {
        let data = args.flat(Infinity)
            .map((item, i) => {
            return {
                id: ++i,
                jsonrpc: '2.0',
                ...item,
            };
        });
        if (data.length === 1 && !(args[0] instanceof Array || args.length > 1)) {
            data = data[0];
        }
        return this
            .request('', data)
            .then(data => {
            return this.mapResponse(data);
        })
            .then((data) => data);
    }
}
exports.Client = Client;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9zcmMvQ2xpZW50L2luZGV4LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7O0FBQUEsa0RBQTBGO0FBQzFGLDJCQUFpRDtBQUNqRCxtREFBOEM7QUFDOUMsNkRBQXdEO0FBT2hELHdCQVBBLDZCQUFhLENBT0E7QUFOckIsMEJBQThHO0FBUTlHLE1BQWEsTUFBTTtJQUlmLFlBQVksTUFBcUI7UUFDN0IsTUFBTSxHQUFHO1lBQ0wsT0FBTyxFQUFFO2dCQUNMLGNBQWMsRUFBRSxrQkFBa0I7YUFDckM7WUFDRCxHQUFHLE1BQU07WUFDVCxHQUFHLEVBQUMsZ0JBQWdCLEVBQWhCLGNBQWdCLEVBQUM7U0FDeEIsQ0FBQztRQUVGLElBQUksTUFBTSxDQUFDLE9BQU8sRUFBRTtZQUNoQixJQUFJLFNBQVMsR0FBRyxJQUFJLEdBQUcsQ0FBQyxNQUFNLENBQUMsT0FBTyxDQUFDLENBQUM7WUFDeEMsSUFBSSxTQUFTLENBQUMsUUFBUSxFQUFFO2dCQUNwQixJQUFJLFdBQVcsR0FBRztvQkFDZCxRQUFRLEVBQUUsU0FBUyxDQUFDLFFBQVE7b0JBQzVCLFFBQVEsRUFBRSxTQUFTLENBQUMsUUFBUTtpQkFDL0IsQ0FBQztnQkFDRixPQUFPLFNBQVMsQ0FBQyxRQUFRLENBQUM7Z0JBQzFCLE9BQU8sU0FBUyxDQUFDLFFBQVEsQ0FBQztnQkFDMUIsTUFBTSxDQUFDLE1BQU0sQ0FBQyxHQUFHLFdBQVcsQ0FBQztnQkFDN0IsTUFBTSxDQUFDLFNBQVMsQ0FBQyxHQUFHLFNBQVMsQ0FBQyxJQUFJLENBQUM7YUFDdEM7U0FDSjtRQUNELElBQUksQ0FBQyxLQUFLLEdBQUcsZUFBSyxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsQ0FBQztJQUN0QyxDQUFDO0lBSUQsV0FBVyxDQUFJLFFBQXVDLEVBQUUsUUFBa0I7UUFDdEUsSUFBSSxRQUFRLFlBQVksS0FBSyxFQUFFO1lBQzNCLE9BQU8sUUFBUSxDQUFDLEdBQUcsQ0FBQyxDQUFDLElBQWtCLEVBQUUsRUFBRTtnQkFDdkMsT0FBTyxJQUFJLENBQUMsV0FBVyxDQUFJLElBQUksRUFBRSxJQUFJLENBQUMsQ0FBQztZQUMzQyxDQUFDLENBQUMsQ0FBQztTQUNOO2FBQU07WUFDSCxJQUFJLFFBQVEsQ0FBQyxLQUFLLEVBQUU7Z0JBQ2hCLElBQUksUUFBUSxFQUFFO29CQUNWLE1BQU0sSUFBSSw2QkFBYSxDQUFDLFFBQVEsQ0FBQyxLQUFLLENBQUMsQ0FBQztpQkFDM0M7cUJBQU07b0JBQ0gsYUFBYTtvQkFDYixJQUFJLElBQUksR0FBRyxRQUFRLENBQUMsSUFBSSxJQUFJLElBQUksQ0FBQztvQkFFakMsSUFBSSxJQUFJLENBQUM7b0JBRVQsUUFBUSxRQUFRLENBQUMsS0FBSyxDQUFDLElBQUksSUFBSSxDQUFDLEtBQUssRUFBRTt3QkFDbkMsS0FBSyxDQUFDLEtBQUs7NEJBQ1AsSUFBSSxHQUFHLGlCQUFhLENBQUM7NEJBQ3JCLE1BQU07d0JBQ1YsS0FBSyxDQUFDLEtBQUs7NEJBQ1AsSUFBSSxHQUFHLGlCQUFhLENBQUM7NEJBQ3JCLE1BQU07d0JBQ1YsS0FBSyxDQUFDLEtBQUs7NEJBQ1AsSUFBSSxHQUFHLGtCQUFjLENBQUM7NEJBQ3RCLE1BQU07d0JBQ1YsS0FBSyxDQUFDLEtBQUs7NEJBQ1AsSUFBSSxHQUFHLGtCQUFjLENBQUM7NEJBQ3RCLE1BQU07d0JBQ1YsS0FBSyxDQUFDLEtBQUs7NEJBQ1AsSUFBSSxHQUFHLGNBQVUsQ0FBQzs0QkFDbEIsTUFBTTt3QkFDVixLQUFLLENBQUMsS0FBSzs0QkFDUCxJQUFJLEdBQUcsZUFBVyxDQUFDOzRCQUNuQixNQUFNO3FCQUNiO29CQUVELE1BQU0sSUFBSSxJQUFJLENBQUMsSUFBSSxFQUFFLFFBQVEsQ0FBQyxLQUFLLENBQUMsT0FBTyxJQUFJLGdCQUFnQixFQUFFLFFBQVEsQ0FBQyxLQUFLLENBQUMsSUFBSSxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUM7aUJBQ25HO2FBQ0o7aUJBQU07Z0JBQ0gsSUFBSSxRQUFRLEVBQUU7b0JBQ1YsSUFBSSxNQUFNLEdBQUcsSUFBSSxtQkFBUSxFQUFLLENBQUM7b0JBQy9CLE1BQU0sQ0FBQyxJQUFJLEdBQUcsUUFBUSxDQUFDLElBQUksQ0FBQztvQkFDNUIsTUFBTSxDQUFDLEVBQUUsR0FBRyxRQUFRLENBQUMsRUFBRSxDQUFDO29CQUN4QixNQUFNLENBQUMsT0FBTyxHQUFHLFFBQVEsQ0FBQyxPQUFPLENBQUM7b0JBQ2xDLE1BQU0sQ0FBQyxNQUFNLEdBQUcsUUFBUSxDQUFDLE1BQU0sQ0FBQztvQkFDaEMsT0FBTyxNQUFNLENBQUM7aUJBQ2pCO3FCQUFNO29CQUNILE9BQU8sUUFBUSxDQUFDLE1BQU0sQ0FBQztpQkFDMUI7YUFDSjtTQUNKO0lBQ0wsQ0FBQztJQUVELEtBQUssQ0FBQyxPQUFPLENBQUMsR0FBRyxFQUFFLE1BQU07UUFDckIsT0FBTyxJQUFJLENBQUMsS0FBSzthQUNaLElBQUksQ0FBQyxHQUFHLEVBQUUsTUFBTSxJQUFJLElBQUksQ0FBQyxhQUFhLEVBQUUsRUFBRSxDQUFDO2FBQzNDLElBQUksQ0FBQyxRQUFRLENBQUMsRUFBRSxDQUFDLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxRQUFRLENBQUMsQ0FBQzthQUN2RCxLQUFLLENBQUMsQ0FBQyxHQUFlLEVBQUUsRUFBRTtZQUN2QixJQUFJLEdBQUcsQ0FBQyxRQUFRLElBQUksR0FBRyxDQUFDLFFBQVEsQ0FBQyxJQUFJLEVBQUU7Z0JBQ25DLE9BQU8sSUFBSSxDQUFDLFdBQVcsQ0FBQyxHQUFHLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxDQUFDO2FBQzlDO1lBQ0QsTUFBTSxHQUFHLENBQUM7UUFDZCxDQUFDLENBQUMsQ0FBQztJQUNYLENBQUM7SUFLRCxHQUFHLENBQUksR0FBRyxJQUF1QztRQUM3QyxJQUFJLElBQUksR0FBb0MsSUFBSSxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUM7YUFDMUQsR0FBRyxDQUFDLENBQUMsSUFBSSxFQUFFLENBQUMsRUFBRSxFQUFFO1lBQ2IsT0FBTztnQkFDSCxFQUFFLEVBQUUsRUFBRSxDQUFDO2dCQUNQLE9BQU8sRUFBRSxLQUFLO2dCQUNkLEdBQUcsSUFBSTthQUNWLENBQUM7UUFDTixDQUFDLENBQUMsQ0FBQztRQUVQLElBQUksSUFBSSxDQUFDLE1BQU0sS0FBSyxDQUFDLElBQUksQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsWUFBWSxLQUFLLElBQUksSUFBSSxDQUFDLE1BQU0sR0FBRyxDQUFDLENBQUMsRUFBRTtZQUNyRSxJQUFJLEdBQUcsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDO1NBQ2xCO1FBRUQsT0FBTyxJQUFJO2FBQ04sT0FBTyxDQUFDLEVBQUUsRUFBRSxJQUFJLENBQUM7YUFDakIsSUFBSSxDQUFDLElBQUksQ0FBQyxFQUFFO1lBQ1QsT0FBTyxJQUFJLENBQUMsV0FBVyxDQUFJLElBQVcsQ0FBQyxDQUFDO1FBQzVDLENBQUMsQ0FBQzthQUNELElBQUksQ0FBQyxDQUFDLElBQVMsRUFBRSxFQUFFLENBQUMsSUFBSSxDQUFDLENBQUM7SUFDbkMsQ0FBQztDQUNKO0FBeEhELHdCQXdIQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBBeGlvcywge0F4aW9zRXJyb3IsIEF4aW9zSW5zdGFuY2UsIEF4aW9zUmVxdWVzdENvbmZpZywgQXhpb3NSZXNwb25zZX0gZnJvbSBcImF4aW9zXCI7XG5pbXBvcnQge3N0cmluZ2lmeSBhcyBwYXJhbXNTZXJpYWxpemVyfSBmcm9tICdxcyc7XG5pbXBvcnQge1Jlc3BvbnNlfSBmcm9tIFwiLi9BYnN0cmFjdHMvUmVzcG9uc2VcIjtcbmltcG9ydCB7RXJyb3JSZXNwb25zZX0gZnJvbSBcIi4vQWJzdHJhY3RzL0Vycm9yUmVzcG9uc2VcIjtcbmltcG9ydCB7SW50ZXJuYWxFcnJvciwgSW52YWxpZFBhcmFtcywgSW52YWxpZFJlcXVlc3QsIE1ldGhvZE5vdEZvdW5kLCBQYXJzZUVycm9yLCBSUEMsIFNlcnZlckVycm9yfSBmcm9tIFwiLi5cIjtcblxuZXhwb3J0IHR5cGUgQ2xpZW50T3B0aW9ucyA9IEF4aW9zUmVxdWVzdENvbmZpZztcblxudHlwZSBUTWFwUmVzb3VyY2UgPSBSUEMuUmVzcG9uc2UuSURhdGE7XG50eXBlIFRNYXBSZXR1cm5UeXBlPFQ+ID0gUmVzcG9uc2U8VD4gfCBFcnJvclJlc3BvbnNlO1xuZXhwb3J0IHtFcnJvclJlc3BvbnNlfTtcblxuZXhwb3J0IGNsYXNzIENsaWVudCB7XG4gICAgYXhpb3M6IEF4aW9zSW5zdGFuY2U7XG4gICAgZGVmYXVsdFBhcmFtczogW107XG5cbiAgICBjb25zdHJ1Y3Rvcihjb25maWc6IENsaWVudE9wdGlvbnMpIHtcbiAgICAgICAgY29uZmlnID0ge1xuICAgICAgICAgICAgaGVhZGVyczoge1xuICAgICAgICAgICAgICAgICdDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24vanNvbidcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAuLi5jb25maWcsXG4gICAgICAgICAgICAuLi57cGFyYW1zU2VyaWFsaXplcn1cbiAgICAgICAgfTtcblxuICAgICAgICBpZiAoY29uZmlnLmJhc2VVUkwpIHtcbiAgICAgICAgICAgIGxldCBwYXJzZWRVcmwgPSBuZXcgVVJMKGNvbmZpZy5iYXNlVVJMKTtcbiAgICAgICAgICAgIGlmIChwYXJzZWRVcmwudXNlcm5hbWUpIHtcbiAgICAgICAgICAgICAgICBsZXQgY3JlZGVudGlhbHMgPSB7XG4gICAgICAgICAgICAgICAgICAgIHVzZXJuYW1lOiBwYXJzZWRVcmwudXNlcm5hbWUsXG4gICAgICAgICAgICAgICAgICAgIHBhc3N3b3JkOiBwYXJzZWRVcmwucGFzc3dvcmQsXG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICBkZWxldGUgcGFyc2VkVXJsLnVzZXJuYW1lO1xuICAgICAgICAgICAgICAgIGRlbGV0ZSBwYXJzZWRVcmwucGFzc3dvcmQ7XG4gICAgICAgICAgICAgICAgY29uZmlnWydhdXRoJ10gPSBjcmVkZW50aWFscztcbiAgICAgICAgICAgICAgICBjb25maWdbJ2Jhc2VVUkwnXSA9IHBhcnNlZFVybC5ocmVmO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHRoaXMuYXhpb3MgPSBBeGlvcy5jcmVhdGUoY29uZmlnKTtcbiAgICB9XG5cbiAgICBtYXBSZXNwb25zZTxUPihyZXNwb25zZTogVE1hcFJlc291cmNlW10sIG11bHRpcGxlPzogYm9vbGVhbik6IFRNYXBSZXR1cm5UeXBlPFQ+W107XG4gICAgbWFwUmVzcG9uc2U8VD4ocmVzcG9uc2U6IFRNYXBSZXNvdXJjZSwgbXVsdGlwbGU/OiBib29sZWFuKTogVE1hcFJldHVyblR5cGU8VD47XG4gICAgbWFwUmVzcG9uc2U8VD4ocmVzcG9uc2U6IFRNYXBSZXNvdXJjZSB8IFRNYXBSZXNvdXJjZVtdLCBtdWx0aXBsZT86IGJvb2xlYW4pOiBUTWFwUmV0dXJuVHlwZTxUPiB8IFRNYXBSZXR1cm5UeXBlPFQ+W10ge1xuICAgICAgICBpZiAocmVzcG9uc2UgaW5zdGFuY2VvZiBBcnJheSkge1xuICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlLm1hcCgoaXRlbTogVE1hcFJlc291cmNlKSA9PiB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMubWFwUmVzcG9uc2U8VD4oaXRlbSwgdHJ1ZSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGlmIChyZXNwb25zZS5lcnJvcikge1xuICAgICAgICAgICAgICAgIGlmIChtdWx0aXBsZSkge1xuICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3JSZXNwb25zZShyZXNwb25zZS5lcnJvcik7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gQHRzLWlnbm9yZVxuICAgICAgICAgICAgICAgICAgICBsZXQgZGF0YSA9IHJlc3BvbnNlLmRhdGEgfHwgbnVsbDtcblxuICAgICAgICAgICAgICAgICAgICBsZXQgZXJyQztcblxuICAgICAgICAgICAgICAgICAgICBzd2l0Y2ggKHJlc3BvbnNlLmVycm9yLmNvZGUgfHwgLTMyNjAzKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlIC0zMjYwMzpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlcnJDID0gSW50ZXJuYWxFcnJvcjtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgLTMyNjAyOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVyckMgPSBJbnZhbGlkUGFyYW1zO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAtMzI2MDA6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZXJyQyA9IEludmFsaWRSZXF1ZXN0O1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAtMzI2MDE6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZXJyQyA9IE1ldGhvZE5vdEZvdW5kO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAtMzI3MDA6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZXJyQyA9IFBhcnNlRXJyb3I7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlIC0zMjAwMDpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlcnJDID0gU2VydmVyRXJyb3I7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgZXJyQyhkYXRhLCByZXNwb25zZS5lcnJvci5tZXNzYWdlIHx8ICdJbnRlcm5hbCBlcnJvcicsIHJlc3BvbnNlLmVycm9yLmNvZGUgfHwgLTMyNjAzKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGlmIChtdWx0aXBsZSkge1xuICAgICAgICAgICAgICAgICAgICBsZXQgcmVzdWx0ID0gbmV3IFJlc3BvbnNlPFQ+KCk7XG4gICAgICAgICAgICAgICAgICAgIHJlc3VsdC5jb2RlID0gcmVzcG9uc2UuY29kZTtcbiAgICAgICAgICAgICAgICAgICAgcmVzdWx0LmlkID0gcmVzcG9uc2UuaWQ7XG4gICAgICAgICAgICAgICAgICAgIHJlc3VsdC5qc29ucnBjID0gcmVzcG9uc2UuanNvbnJwYztcbiAgICAgICAgICAgICAgICAgICAgcmVzdWx0LnJlc3VsdCA9IHJlc3BvbnNlLnJlc3VsdDtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UucmVzdWx0O1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cblxuICAgIGFzeW5jIHJlcXVlc3QodXJsLCBwYXJhbXMpOiBQcm9taXNlPEF4aW9zUmVzcG9uc2UgfCBBeGlvc1Jlc3BvbnNlW10+IHtcbiAgICAgICAgcmV0dXJuIHRoaXMuYXhpb3NcbiAgICAgICAgICAgIC5wb3N0KHVybCwgcGFyYW1zIHx8IHRoaXMuZGVmYXVsdFBhcmFtcywge30pXG4gICAgICAgICAgICAudGhlbihyZXNwb25zZSA9PiAocmVzcG9uc2UgPyByZXNwb25zZS5kYXRhIDogcmVzcG9uc2UpKVxuICAgICAgICAgICAgLmNhdGNoKChlcnI6IEF4aW9zRXJyb3IpID0+IHtcbiAgICAgICAgICAgICAgICBpZiAoZXJyLnJlc3BvbnNlICYmIGVyci5yZXNwb25zZS5kYXRhKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLm1hcFJlc3BvbnNlKGVyci5yZXNwb25zZS5kYXRhKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgdGhyb3cgZXJyO1xuICAgICAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgcnBjPFQ+KGFyZ3M6IFJQQy5JUGF5bG9hZCk6IFByb21pc2U8VD47XG4gICAgcnBjPFQ+KGFyZzE6IFJQQy5JUGF5bG9hZCwgLi4uYXJnczogUlBDLklQYXlsb2FkW10pOiBQcm9taXNlPFRNYXBSZXR1cm5UeXBlPFQ+W10+O1xuICAgIHJwYzxUPihhcmdzOiBSUEMuSVBheWxvYWRbXSk6IFByb21pc2U8VE1hcFJldHVyblR5cGU8VD5bXT47XG4gICAgcnBjPFQ+KC4uLmFyZ3M6IChSUEMuSVBheWxvYWQgfCBSUEMuSVBheWxvYWRbXSlbXSk6IFByb21pc2U8VD4ge1xuICAgICAgICBsZXQgZGF0YTogKFJQQy5JUGF5bG9hZCB8IFJQQy5JUGF5bG9hZFtdKSA9IGFyZ3MuZmxhdChJbmZpbml0eSlcbiAgICAgICAgICAgIC5tYXAoKGl0ZW0sIGkpID0+IHtcbiAgICAgICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgICAgICBpZDogKytpLFxuICAgICAgICAgICAgICAgICAgICBqc29ucnBjOiAnMi4wJyxcbiAgICAgICAgICAgICAgICAgICAgLi4uaXRlbSxcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgaWYgKGRhdGEubGVuZ3RoID09PSAxICYmICEoYXJnc1swXSBpbnN0YW5jZW9mIEFycmF5IHx8IGFyZ3MubGVuZ3RoID4gMSkpIHtcbiAgICAgICAgICAgIGRhdGEgPSBkYXRhWzBdO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHRoaXNcbiAgICAgICAgICAgIC5yZXF1ZXN0KCcnLCBkYXRhKVxuICAgICAgICAgICAgLnRoZW4oZGF0YSA9PiB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMubWFwUmVzcG9uc2U8VD4oZGF0YSBhcyBhbnkpO1xuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIC50aGVuKChkYXRhOiBhbnkpID0+IGRhdGEpO1xuICAgIH1cbn1cbiJdfQ==